# Makefile to generate data:
#  template scripts -> final scripts
#  markdown files -> html files

CAPSMAN = $(wildcard *.capsman.rsc)
LOCAL = $(wildcard *.local.rsc)
WIFI = $(wildcard *.wifi.rsc)

MARKDOWN = $(wildcard *.md doc/*.md doc/mod/*.md)
HTML = $(MARKDOWN:.md=.html) style.css

all: $(CAPSMAN) $(LOCAL) $(WIFI) $(HTML) checksums.json

style.css: contrib/general/style.css
	cp $< $@

%.html: %.md style.css contrib/html.sh contrib/html.sh.d/head.html
	contrib/html.sh $< > $@

%.capsman.rsc: %.template.rsc Makefile
	sed -e '/\/interface\/wifi\//d' -e '/\/interface\/wireless\//d' -e 's|%TEMPL%|.capsman|' \
		-e '/^# NOT \/caps-man\/ #$$/,/^# NOT \/caps-man\/ #$$/d' \
		-e '/^# !!/,/^# !!/c # !! Do not edit this file, it is generated from template!' \
		< $< > $@

%.local.rsc: %.template.rsc Makefile
	sed -e '/\/caps-man\//d' -e '/\/interface\/wifi\//d' -e 's|%TEMPL%|.local|' \
		-e '/^# NOT \/interface\/wireless\/ #$$/,/^# NOT \/interface\/wireless\/ #$$/d' \
		-e '/^# !!/,/^# !!/c # !! Do not edit this file, it is generated from template!' \
		< $< > $@

%.wifi.rsc: %.template.rsc Makefile
	sed -e '/\/caps-man\//d' -e '/\/interface\/wireless\//d' -e 's|%TEMPL%|.wifi|' \
		-e '/^# NOT \/interface\/wifi\/ #$$/,/^# NOT \/interface\/wifi\/ #$$/d' \
		-e '/^# !!/,/^# !!/c # !! Do not edit this file, it is generated from template!' \
		< $< > $@

checksums.json: contrib/checksums.sh *.rsc */*.rsc
	contrib/checksums.sh

clean:
	rm -f $(HTML) checksums.json
